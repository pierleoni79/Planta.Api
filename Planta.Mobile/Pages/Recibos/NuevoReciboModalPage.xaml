<?xml version="1.0" encoding="utf-8" ?>
<!-- Ruta: /Planta.Mobile/Pages/Recibos/NuevoReciboModalPage.xaml | V1.0 -->
<ContentPage
    x:Class="Planta.Mobile.Pages.Recibos.NuevoReciboModalPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Title="Nuevo Recibo">

    <!-- Layout con botón sticky -->
    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Encabezado -->
        <VerticalStackLayout Padding="16,12" Spacing="2">
            <Label Text="Nuevo Recibo" FontSize="22" FontAttributes="Bold"/>
            <Label x:Name="LblSubtitulo" Text="Origen: Cantera (planta de sesión)" FontSize="13" TextColor="{DynamicResource SecondaryTextColor}"/>
        </VerticalStackLayout>

        <!-- Contenido desplazable -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="16" Spacing="18">

                <!-- Sección A — Básicos -->
                <Label Text="Sección A — Básicos" FontAttributes="Bold" />

                <!-- Placa -->
                <VerticalStackLayout Spacing="6">
                    <Label Text="Placa" />
                    <Entry x:Name="TxtPlaca" Placeholder="Ej.: ABC123" Keyboard="Text" Completed="OnPlacaCompleted"/>
                    <Label Text="Escribe la placa. Se resolverán vehículo y conductor automáticamente."
                           FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
                    <Label x:Name="ErrPlaca" Text="" TextColor="Red" FontSize="12"/>
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                        <Label x:Name="LblVehiculoResumen" Text="Vehículo: —" />
                        <Button Grid.Column="1" Text="Resolver" Clicked="OnResolverPlacaClicked"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- Material -->
                <VerticalStackLayout Spacing="6">
                    <Label Text="Material" />
                    <Picker x:Name="PickMaterial" Title="Selecciona material" ItemDisplayBinding="{Binding Nombre}" SelectedIndexChanged="OnMaterialChanged"/>
                    <Label Text="Material a recibir." FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
                    <Label x:Name="ErrMaterial" Text="" TextColor="Red" FontSize="12"/>
                </VerticalStackLayout>

                <!-- Destino (chips) -->
                <VerticalStackLayout Spacing="6">
                    <Label Text="Destino" />
                    <toolkit:SegmentedControl x:Name="SegDestino" SelectionChanged="OnDestinoChanged">
                        <toolkit:SegmentedControl.Items>
                            <toolkit:SegmentedControlItem Text="Cliente"/>
                            <toolkit:SegmentedControlItem Text="Planta"/>
                        </toolkit:SegmentedControl.Items>
                    </toolkit:SegmentedControl>
                    <Label Text="¿A dónde llega el material?"
                           FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
                </VerticalStackLayout>

                <!-- Cantidad + Unidad (chips) -->
                <VerticalStackLayout Spacing="6">
                    <Label Text="Cantidad" />
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                        <Entry x:Name="TxtCantidad" Placeholder="0,000" Keyboard="Numeric" TextChanged="OnCantidadChanged"/>
                        <toolkit:SegmentedControl Grid.Column="1" x:Name="SegUnidad" WidthRequest="160" SelectionChanged="OnUnidadChanged">
                            <toolkit:SegmentedControl.Items>
                                <toolkit:SegmentedControlItem Text="m³"/>
                                <toolkit:SegmentedControlItem Text="viaje"/>
                            </toolkit:SegmentedControl.Items>
                        </toolkit:SegmentedControl>
                    </Grid>
                    <Label x:Name="LblAyudaCantidad" Text="—" FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
                    <Label x:Name="ErrCantidad" Text="" TextColor="Red" FontSize="12"/>
                    <Label x:Name="ErrUnidad" Text="" TextColor="Red" FontSize="12"/>
                </VerticalStackLayout>

                <!-- Observaciones -->
                <VerticalStackLayout Spacing="6">
                    <Label Text="Observaciones (opcional)" />
                    <Editor x:Name="TxtObs" Placeholder="Escribe una nota (opcional)" AutoSize="TextChanges" />
                </VerticalStackLayout>

                <!-- Sección B — Destino (condicional) -->
                <Label Text="Sección B — Destino" FontAttributes="Bold" />

                <!-- Cliente -->
                <VerticalStackLayout x:Name="SecCliente" Spacing="6" IsVisible="True">
                    <Label Text="Cliente" />
                    <Picker x:Name="PickCliente" Title="Selecciona cliente" ItemDisplayBinding="{Binding Nombre}" />
                    <Label x:Name="ErrCliente" Text="" TextColor="Red" FontSize="12"/>
                </VerticalStackLayout>

                <!-- Planta destino -->
                <VerticalStackLayout x:Name="SecPlanta" Spacing="6" IsVisible="False">
                    <Label Text="Planta destino" />
                    <Picker x:Name="PickPlanta" Title="Selecciona planta" ItemDisplayBinding="{Binding Nombre}" />
                    <Label x:Name="ErrPlantaDestino" Text="" TextColor="Red" FontSize="12"/>
                </VerticalStackLayout>

                <!-- Sección C — Derivados / Solo lectura -->
                <Label Text="Sección C — Derivados / Solo lectura" FontAttributes="Bold" />

                <!-- Vehículo -->
                <VerticalStackLayout Spacing="2">
                    <Label x:Name="LblVehiculoClaseCap" Text="Clase: — · Capacidad: — m³" />
                </VerticalStackLayout>

                <!-- Conductor -->
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                    <VerticalStackLayout Spacing="2">
                        <Label x:Name="LblConductor" Text="Conductor: —" />
                        <Label x:Name="LblConductorFuente" Text="—" FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
                        <Label x:Name="AlertaConductor" Text="" TextColor="OrangeRed" FontSize="12"/>
                    </VerticalStackLayout>
                    <Button Grid.Column="1" Text="Cambiar" Clicked="OnCambiarConductor"/>
                </Grid>

                <!-- Unidad/Cantidad (origen de la regla) -->
                <Label x:Name="LblOrigenUnidad" Text="Sin tarifa: captura manual." FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />

                <!-- Almacén origen -->
                <Label x:Name="LblAlmacen" Text="Almacén origen: Cantera – —" />

            </VerticalStackLayout>
        </ScrollView>

        <!-- Botón sticky -->
        <Border Grid.Row="2" StrokeThickness="0" BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1e1e1e}">
            <VerticalStackLayout Padding="16" Spacing="8">
                <Button x:Name="BtnCrear" Text="Crear Recibo" Clicked="OnCrear" IsEnabled="False"/>
                <Label x:Name="LblChecklist" Text="• Placa válida • Material • Destino • Unidad • Cantidad > 0 • Conexión disponible"
                       FontSize="12" TextColor="{DynamicResource SecondaryTextColor}" />
            </VerticalStackLayout>
        </Border>
    </Grid>
</ContentPage>
